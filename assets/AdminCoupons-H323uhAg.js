import{S as x}from"./sweetalert2.all-mwGm6plC.js";import{_ as D,o as u,c as p,a as t,h as c,p as h,s as S,t as g,q as r,r as m,b as _,F as b,i as k,j as y}from"./index-U9yuG7nn.js";import{P as L}from"./PaginationComponent-c_2z8jAn.js";import{m as T}from"./modalMixin-GELrwi3C.js";import{D as V}from"./DelModal-yTKdUwlT.js";const N={props:["isNew","tempCoupon"],emits:["update-coupon"],mixins:[T],data(){return{editCoupon:{data:{}},due_date:""}},mounted(){this.editCoupon=this.tempCoupon,this.setDueDate()},methods:{setDueDate(){if(this.isNew===!0)this.due_date=this.getCurrentDate();else{const o=new Date(this.tempCoupon.data.due_date*1e3),e=o.getFullYear(),a=String(o.getMonth()+1).padStart(2,"0"),s=String(o.getDate()).padStart(2,"0");this.due_date=`${e}-${a}-${s}`}},getCurrentDate(){const o=new Date,e=o.getFullYear(),a=String(o.getMonth()+1).padStart(2,"0"),s=String(o.getDate()).padStart(2,"0");return`${e}-${a}-${s}`}},watch:{tempCoupon:{handler(){this.editCoupon=this.tempCoupon;const o=new Date(this.editCoupon.data.due_date*1e3).toISOString().split("T");[this.due_date]=o},deep:!0},due_date(){this.editCoupon.data.due_date=Math.floor(new Date(this.due_date)/1e3)}}},U={class:"modal fade",id:"couponModal",ref:"modal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},P={class:"modal-dialog"},E={class:"modal-content"},B={class:"modal-header bg-dark text-white"},I={class:"modal-title",id:"couponModalLabel"},A={key:0},F={key:1},R=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},O={class:"mb-3"},Y=t("label",{for:"title"},"標題",-1),H={class:"mb-3"},q=t("label",{for:"coupon_code"},"優惠碼",-1),z={class:"mb-3"},G=t("label",{for:"due_date"},"到期日",-1),J={class:"mb-3"},K=t("label",{for:"percent"},"折扣百分比",-1),Q={class:"mb-3"},W={class:"form-check"},X=t("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),Z={class:"modal-footer"},tt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消",-1);function et(o,e,a,s,n,d){return u(),p("div",U,[t("div",P,[t("div",E,[t("div",B,[t("h5",I,[a.isNew?(u(),p("span",A,"新增優惠卷")):(u(),p("span",F,"編輯優惠卷"))]),R]),t("div",j,[t("div",O,[Y,c(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[0]||(e[0]=i=>n.editCoupon.data.title=i)},null,512),[[h,n.editCoupon.data.title]])]),t("div",H,[q,c(t("input",{id:"coupon_code",type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":e[1]||(e[1]=i=>n.editCoupon.data.code=i)},null,512),[[h,n.editCoupon.data.code]])]),t("div",z,[G,c(t("input",{id:"due_date",type:"date",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=i=>n.due_date=i)},null,512),[[h,n.due_date]])]),t("div",J,[K,c(t("input",{id:"percent",type:"number",class:"form-control",min:"0",placeholder:"請輸入折扣百分比","onUpdate:modelValue":e[3]||(e[3]=i=>n.editCoupon.data.percent=i)},null,512),[[h,n.editCoupon.data.percent,void 0,{number:!0}]])]),t("div",Q,[t("div",W,[c(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=i=>n.editCoupon.data.is_enabled=i),"true-value":1,"false-value":0},null,512),[[S,n.editCoupon.data.is_enabled]]),X])])]),t("div",Z,[tt,t("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=i=>o.$emit("update-coupon",n.editCoupon))},g(a.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const ot=D(N,[["render",et]]);var nt={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"dorayu",BASE_URL:"/vite-deploy-week07/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_PATH:C}=nt,st={data(){return{coupons:[],pagination:{},tempCoupon:{data:{}},isNew:!0,isLoading:!1,fieldTranslation:{title:"標題",percent:"折扣百分比",code:"優惠碼"}}},components:{PaginationComponent:L,CouponModal:ot,DelModal:V},methods:{openCouponModal(o,e){o==="createNew"?(this.isNew=!0,this.tempCoupon.data={due_date:Math.floor(new Date().getTime()/1e3),is_enabled:0},this.$refs.couponModal.openModal(),this.$refs.couponModal.setDueDate()):o==="edit"?(this.isNew=!1,this.tempCoupon.data={...e},this.$refs.couponModal.openModal(),this.$refs.couponModal.setDueDate()):o==="delete"&&(this.tempCoupon.data={...e},this.$refs.delModal.openModal())},formatDate(o){return new Date(o*1e3).toLocaleDateString()},getCoupons(o=1){this.isLoading=!0;const e=`${f}/api/${C}/admin/coupons?page=${o}`;this.axios.get(e).then(a=>{const{coupons:s,pagination:n}=a.data;this.coupons=s,this.pagination=n,this.isLoading=!1,r.success("成功取得優惠券")}).catch(a=>{this.isLoading=!1,r.error(a.response.data.message)})},updateCoupon(o){this.isLoading=!0;let e=`${f}/api/${C}/admin/coupon`,a="post";this.isNew||(e+=`/${o.id}`,a="put"),this.axios[a](e,o).then(s=>{this.isLoading=!1,r.success(s.data.message),this.getCoupons(),this.$refs.couponModal.hideModal()}).catch(s=>{this.isLoading=!1;let n=Array.isArray(s.response.data.message)?s.response.data.message.join(`
`):s.response.data.message;n=n.replace(/(\w+) 欄位/g,(d,i)=>`${this.fieldTranslation[i]||i} 欄位`),r.error(n)})},delCoupon(o){const e=`${f}/api/${C}/admin/coupon/${o.id}`;x.fire({title:`確定要刪除<span class="text-danger">${o.title}</span>嗎?`,showDenyButton:!0,confirmButtonText:"是，我要刪除",denyButtonText:"不要刪除"}).then(a=>{a.isConfirmed&&this.axios.delete(e).then(s=>{this.getCoupons(),r.success(s.data.message)}).catch(s=>{r.error(s.response.data.message)})})},getCurrentDate(){const o=new Date,e=o.getFullYear(),a=String(o.getMonth()+1).padStart(2,"0"),s=String(o.getDate()).padStart(2,"0");return`${e}-${a}-${s}`}},mounted(){this.getCoupons()}},at={class:"container"},it={class:"d-flex justify-content-between mt-4"},dt=t("h2",null,"優惠卷列表",-1),lt={class:"table mt-4"},ut=t("thead",null,[t("tr",null,[t("th",null,"名稱"),t("th",null,"折扣百分比"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1),pt={key:0,class:"text-success"},rt={key:1,class:"text-muted"},ct={class:"btn-group"},ht=["onClick"],mt=["onClick"];function _t(o,e,a,s,n,d){const i=m("VueLoading"),v=m("PaginationComponent"),M=m("CouponModal"),w=m("DelModal");return u(),p(b,null,[_(i,{active:n.isLoading},null,8,["active"]),t("div",at,[t("div",it,[dt,t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=l=>d.openCouponModal("createNew"))}," 建立新的優惠卷 ")]),t("table",lt,[ut,t("tbody",null,[(u(!0),p(b,null,k(n.coupons,l=>(u(),p("tr",{key:l.id},[t("td",null,g(l.title),1),t("td",null,g(l.percent)+"%",1),t("td",null,g(d.formatDate(l.due_date)),1),t("td",null,[l.is_enabled===1?(u(),p("span",pt,"啟用")):(u(),p("span",rt,"未啟用"))]),t("td",null,[t("div",ct,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:y($=>d.openCouponModal("edit",l),["prevent"])},"編輯",8,ht),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:y($=>d.delCoupon(l),["prevent"])},"刪除",8,mt)])])]))),128))])]),_(v,{pages:n.pagination,onChangePage:d.getCoupons},null,8,["pages","onChangePage"])]),_(M,{ref:"couponModal","is-new":n.isNew,"temp-coupon":n.tempCoupon,onUpdateCoupon:d.updateCoupon},null,8,["is-new","temp-coupon","onUpdateCoupon"]),_(w,{ref:"delModal",item:n.tempCoupon,onDelItem:d.delCoupon},null,8,["item","onDelItem"])],64)}const Dt=D(st,[["render",_t]]);export{Dt as default};
