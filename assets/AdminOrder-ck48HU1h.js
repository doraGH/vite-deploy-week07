import{S as p}from"./sweetalert2.all-mwGm6plC.js";import{_ as x,q as _,o as c,c as u,a as e,t as a,h as y,s as D,F as O,i as T,p as E,l as L,j as b,r as h,b as m,n as v,d as w}from"./index-U9yuG7nn.js";import{P as A}from"./PaginationComponent-c_2z8jAn.js";import{m as P}from"./modalMixin-GELrwi3C.js";var $={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"dorayu",BASE_URL:"/vite-deploy-week07/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:U,VITE_PATH:B}=$,I={props:["tempOrder","getOrders"],emit:["edit-order"],mixins:[P],data(){return{editOrder:{data:{}}}},mounted(){this.editOrder=this.tempOrder},methods:{updateOrder(){const d=this.editOrder.data.id,s=`${U}/api/${B}/admin/order/${d}`;this.axios.put(s,this.editOrder).then(t=>{_.success(t.data.message),this.modal.hide(),this.$emit("updateOrder")}).catch(t=>{const i=Array.isArray(t.response.data.message)?t.response.data.message.join(`
`):t.response.data.message;_.error(i)})},formatDate(d){return new Date(d*1e3).toLocaleDateString()}},watch:{tempOrder(){this.editOrder=this.tempOrder}}},R={class:"modal fade",id:"orderModal",ref:"modal",tabindex:"-1","aria-labelledby":"orderModallLabel","aria-hidden":"true"},S={class:"modal-dialog modal-xl"},H={class:"modal-content border-0"},N=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{class:"modal-title"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),j={class:"modal-body"},q=e("h6",null,"訂單內容",-1),F={class:"table"},z=e("th",null,"訂單編號",-1),G=e("th",null,"訂單日期",-1),J=e("th",null,"付款狀態",-1),K={class:"form-check"},Q={class:"form-check-label",for:"is_paid"},W={key:0,class:"text-success"},X={key:1,class:"text-muted"},Y=e("th",null,"總金額",-1),Z=e("h6",null,"選購商品",-1),ee={class:"table"},te=e("thead",null,[e("tr",null,[e("th",null,"圖片"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",{class:"text-end"},"單價")])],-1),se=["src"],de={class:"text-end"},ne=e("h6",null,"用戶資料",-1),ae={class:"table"},oe={key:0},re=e("td",null,"姓名",-1),le=e("td",null,"Email",-1),ie=e("td",null,"電話",-1),ce=e("td",null,"地址",-1),ue={class:"modal-footer"},_e=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function he(d,s,t,i,o,r){return c(),u("div",R,[e("div",S,[e("div",H,[N,e("div",j,[q,e("table",F,[e("tbody",null,[e("tr",null,[z,e("td",null,a(t.tempOrder.data.id),1)]),e("tr",null,[G,e("td",null,a(r.formatDate(t.tempOrder.data.create_at)),1)]),e("tr",null,[J,e("td",null,[e("div",K,[y(e("input",{class:"form-check-input",type:"checkbox",id:"is_paid","onUpdate:modelValue":s[0]||(s[0]=n=>o.editOrder.data.is_paid=n),"true-value":!0,"false-value":!1},null,512),[[D,o.editOrder.data.is_paid]]),e("label",Q,[t.tempOrder.data.is_paid?(c(),u("span",W,"已付款")):(c(),u("span",X,"未付款"))])])])]),e("tr",null,[Y,e("td",null," $ "+a(t.tempOrder.data.total),1)])])]),Z,e("table",ee,[te,e("tbody",null,[(c(!0),u(O,null,T(t.tempOrder.data.products,n=>(c(),u("tr",{key:n.id},[e("td",null,[e("img",{class:"img-cart",src:n.product.imageUrl,alt:""},null,8,se)]),e("td",null,a(n.product.title),1),e("td",null,a(n.qty)+" / "+a(n.product.unit),1),e("td",de," $ "+a(n.final_total),1)]))),128))])]),ne,e("table",ae,[t.tempOrder.data.user?(c(),u("tbody",oe,[e("tr",null,[re,e("td",null,a(t.tempOrder.data.user.name),1)]),e("tr",null,[le,e("td",null,a(t.tempOrder.data.user.email),1)]),e("tr",null,[ie,e("td",null,a(t.tempOrder.data.user.tel),1)]),e("tr",null,[ce,e("td",null,[y(e("input",{id:"address",type:"text",class:"form-control",placeholder:"請輸入地址","onUpdate:modelValue":s[1]||(s[1]=n=>o.editOrder.data.user.address=n)},null,512),[[E,o.editOrder.data.user.address]])])])])):L("",!0)])]),e("div",ue,[_e,e("button",{type:"button",class:"btn btn-primary",onClick:s[2]||(s[2]=b((...n)=>r.updateOrder&&r.updateOrder(...n),["prevent"]))}," 確認 ")])])])],512)}const me=x(I,[["render",he]]);var pe={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"dorayu",BASE_URL:"/vite-deploy-week07/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_PATH:g}=pe,fe={data(){return{orders:[],pagination:{},tempOrder:{data:{}},isLoading:!1}},components:{PaginationComponent:A,OrderModal:me},methods:{getOrders(d=1){const s=`${f}/api/${g}/admin/orders?page=${d}`;this.isLoading=!0,this.axios.get(s).then(t=>{const{orders:i,pagination:o}=t.data;this.isLoading=!1,this.orders=i,this.pagination=o,_.success("成功取得訂單")}).catch(t=>{_.error(t.response.data.message)})},formatDate(d){return new Date(d*1e3).toLocaleDateString()},delOneOrder(d){const s=`${f}/api/${g}/admin/order/${d}`;p.fire({title:"確定要刪除訂單嗎?",showDenyButton:!0,confirmButtonText:"是，我要刪除",denyButtonText:"不要刪除"}).then(t=>{t.isConfirmed&&this.axios.delete(s,d).then(i=>{_.success(i.data.message),this.getOrders()}).catch(i=>{_.error(i.response.data.message)})})},delAllOrder(){const d=`${f}/api/${g}/admin/orders/all`;p.fire({title:'確定要清空<span class="text-danger">全部</span>訂單嗎?',showDenyButton:!0,confirmButtonText:"是，我要刪除",denyButtonText:"不要刪除"}).then(s=>{s.isConfirmed&&this.axios.delete(d).then(t=>{_.success(t.data.message),this.getOrders(),p.fire("您已刪除全部訂單")}).catch(t=>{_.error(t.response.data.message)})})},openOrderModal(d,s){d==="edit"?(this.tempOrder.data={...s},this.$refs.orderModal.openModal()):d==="delete"&&(this.tempOrder.data={...s},this.$refs.delModal.openModal())}},mounted(){this.getOrders()}},ge={class:"container"},Oe={class:"d-flex justify-content-between mt-4"},be=e("h2",null,"訂單列表",-1),ye={class:"text-end"},ve={class:"table align-middle"},xe=e("thead",null,[e("tr",null,[e("th",null,"訂單日期"),e("th",null,"訂單編號"),e("th",null,"訂單總金額"),e("th",null,"付款狀態"),e("th",null,"查看訂單")])],-1),Te={class:"btn-group"},ke=["onClick"],Ve=["onClick"];function Me(d,s,t,i,o,r){const n=h("VueLoading"),k=h("font-awesome-icon"),V=h("PaginationComponent"),M=h("OrderModal");return c(),u(O,null,[m(n,{active:o.isLoading},null,8,["active"]),e("div",ge,[e("div",Oe,[be,e("div",ye,[e("button",{class:v(["btn btn-outline-danger",{disabled:o.orders.length===0}]),type:"button",onClick:s[0]||(s[0]=(...l)=>r.delAllOrder&&r.delAllOrder(...l))},"清空訂單",2)])]),e("table",ve,[xe,e("tbody",null,[(c(!0),u(O,null,T(o.orders,l=>(c(),u("tr",{key:l.id},[e("td",null,a(r.formatDate(l.create_at)),1),e("td",null,a(l.id),1),e("td",null,"NT$ "+a(l.total),1),e("td",null,[e("span",{class:v({"text-success":l.is_paid})},a(l.is_paid?"已付款":"未付款"),3)]),e("td",null,[e("div",Te,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:b(C=>r.openOrderModal("edit",l),["prevent"])},[m(k,{icon:["fas","eye"]}),w(" 修改 ")],8,ke),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:b(C=>r.delOneOrder(l.id),["prevent"])}," 刪除 ",8,Ve)])])]))),128))])]),m(V,{pages:o.pagination,onChangePage:r.getOrders},null,8,["pages","onChangePage"])]),m(M,{ref:"orderModal","temp-order":o.tempOrder,onUpdateOrder:r.getOrders},null,8,["temp-order","onUpdateOrder"])],64)}const we=x(fe,[["render",Me]]);export{we as default};
