import{S as L}from"./sweetalert2.all-hWzV_FaV.js";import{_ as y,o as l,c as u,a as t,h as p,p as _,s as T,t as m,d as v,q as r,r as b,b as g,F as $,i as V,j as M}from"./index-0oAfesL3.js";import{P as N}from"./PaginationComponent-bisSQ6Ks.js";import{m as D}from"./modalMixin-3ahUuqr-.js";const U={props:["isNew","tempCoupon"],emits:["update-coupon"],mixins:[D],data(){return{editCoupon:{data:{}},due_date:""}},mounted(){this.editCoupon=this.tempCoupon,this.setDueDate()},methods:{setDueDate(){if(this.isNew===!0)this.due_date=this.getCurrentDate();else{const o=new Date(this.tempCoupon.data.due_date*1e3),e=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),a=String(o.getDate()).padStart(2,"0");this.due_date=`${e}-${s}-${a}`}},getCurrentDate(){const o=new Date,e=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),a=String(o.getDate()).padStart(2,"0");return`${e}-${s}-${a}`}},watch:{tempCoupon:{handler(){this.editCoupon=this.tempCoupon;const o=new Date(this.editCoupon.data.due_date*1e3).toISOString().split("T");[this.due_date]=o},deep:!0},due_date(){this.editCoupon.data.due_date=Math.floor(new Date(this.due_date)/1e3)}}},P={class:"modal fade",id:"couponModal",ref:"modal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},E={class:"modal-dialog"},B={class:"modal-content"},I={class:"modal-header bg-dark text-white"},A={class:"modal-title",id:"couponModalLabel"},F={key:0},R={key:1},j=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),O={class:"modal-body"},Y={class:"mb-3"},H=t("label",{for:"title"},"標題",-1),q={class:"mb-3"},z=t("label",{for:"coupon_code"},"優惠碼",-1),G={class:"mb-3"},J=t("label",{for:"due_date"},"到期日",-1),K={class:"mb-3"},Q=t("label",{for:"percent"},"折扣百分比",-1),W={class:"mb-3"},X={class:"form-check"},Z=t("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),tt={class:"modal-footer"},et=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消",-1);function ot(o,e,s,a,n,i){return l(),u("div",P,[t("div",E,[t("div",B,[t("div",I,[t("h5",A,[s.isNew?(l(),u("span",F,"新增優惠卷")):(l(),u("span",R,"編輯優惠卷"))]),j]),t("div",O,[t("div",Y,[H,p(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":e[0]||(e[0]=d=>n.editCoupon.data.title=d)},null,512),[[_,n.editCoupon.data.title]])]),t("div",q,[z,p(t("input",{id:"coupon_code",type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":e[1]||(e[1]=d=>n.editCoupon.data.code=d)},null,512),[[_,n.editCoupon.data.code]])]),t("div",G,[J,p(t("input",{id:"due_date",type:"date",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=d=>n.due_date=d)},null,512),[[_,n.due_date]])]),t("div",K,[Q,p(t("input",{id:"percent",type:"number",class:"form-control",min:"0",placeholder:"請輸入折扣百分比","onUpdate:modelValue":e[3]||(e[3]=d=>n.editCoupon.data.percent=d)},null,512),[[_,n.editCoupon.data.percent,void 0,{number:!0}]])]),t("div",W,[t("div",X,[p(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=d=>n.editCoupon.data.is_enabled=d),"true-value":1,"false-value":0},null,512),[[T,n.editCoupon.data.is_enabled]]),Z])])]),t("div",tt,[et,t("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=d=>o.$emit("update-coupon",n.editCoupon))},m(s.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const nt=y(U,[["render",ot]]),st={props:{item:Object},emits:["del-item"],mixins:[D]},at={class:"modal fade",id:"delModal",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},dt={class:"modal-dialog"},it={class:"modal-content border-0"},lt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{class:"modal-title"},[t("span",null,"刪除")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ut={class:"modal-body"},ct={class:"text-danger"},rt={class:"modal-footer"},pt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function mt(o,e,s,a,n,i){return l(),u("div",at,[t("div",dt,[t("div",it,[lt,t("div",ut,[v(" 是否刪除 "),t("strong",ct,m(s.item.data),1),v(" (刪除後將無法恢復)。 ")]),t("div",rt,[pt,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=d=>o.$emit("del-item"))}," 確認刪除 ")])])])],512)}const ht=y(st,[["render",mt]]);var _t={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"dorayu",BASE_URL:"/vite-deploy-week07/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:f,VITE_PATH:C}=_t,bt={data(){return{coupons:[],pagination:{},tempCoupon:{data:{}},isNew:!0,isLoading:!1,fieldTranslation:{title:"標題",percent:"折扣百分比",code:"優惠碼"}}},components:{PaginationComponent:N,CouponModal:nt,DelModal:ht},methods:{openCouponModal(o,e){o==="createNew"?(this.isNew=!0,this.tempCoupon.data={due_date:Math.floor(new Date().getTime()/1e3),is_enabled:0},this.$refs.couponModal.openModal(),this.$refs.couponModal.setDueDate()):o==="edit"?(this.isNew=!1,this.tempCoupon.data={...e},this.$refs.couponModal.openModal(),this.$refs.couponModal.setDueDate()):o==="delete"&&(this.tempCoupon.data={...e},this.$refs.delModal.openModal())},formatDate(o){return new Date(o*1e3).toLocaleDateString()},getCoupons(o=1){this.isLoading=!0;const e=`${f}/api/${C}/admin/coupons?page=${o}`;this.axios.get(e).then(s=>{const{coupons:a,pagination:n}=s.data;this.coupons=a,this.pagination=n,this.isLoading=!1,r.success("成功取得優惠券")}).catch(s=>{this.isLoading=!1,r.error(s.response.data.message)})},updateCoupon(o){this.isLoading=!0;let e=`${f}/api/${C}/admin/coupon`,s="post",a=o;this.isNew||(e=`${f}/api/${C}/admin/coupon/${this.tempCoupon.data.id}`,s="put",a=this.tempCoupon),this.axios[s](e,a).then(n=>{this.isLoading=!1,r.success(n.data.message),this.getCoupons(),this.$refs.couponModal.hideModal()}).catch(n=>{this.isLoading=!1;let i=Array.isArray(n.response.data.message)?n.response.data.message.join(`
`):n.response.data.message;i=i.replace(/(\w+) 欄位/g,(d,h)=>`${this.fieldTranslation[h]||h} 欄位`),r.error(i)})},delCoupon(o){const e=`${f}/api/${C}/admin/coupon/${o.id}`;L.fire({title:`確定要刪除<span class="text-danger">${o.title}</span>嗎?`,showDenyButton:!0,confirmButtonText:"是，我要刪除",denyButtonText:"不要刪除"}).then(s=>{s.isConfirmed&&this.axios.delete(e).then(a=>{this.getCoupons(),r.success(a.data.message)}).catch(a=>{r.error(a.response.data.message)})})},getCurrentDate(){const o=new Date,e=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),a=String(o.getDate()).padStart(2,"0");return`${e}-${s}-${a}`}},mounted(){this.getCoupons()}},gt={class:"container"},ft={class:"d-flex justify-content-between mt-4"},Ct=t("h2",null,"優惠卷列表",-1),yt={class:"table mt-4"},vt=t("thead",null,[t("tr",null,[t("th",null,"名稱"),t("th",null,"折扣百分比"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1),$t={key:0,class:"text-success"},Mt={key:1,class:"text-muted"},Dt={class:"btn-group"},wt=["onClick"],xt=["onClick"];function St(o,e,s,a,n,i){const d=b("VueLoading"),h=b("PaginationComponent"),w=b("CouponModal"),x=b("DelModal");return l(),u($,null,[g(d,{active:n.isLoading},null,8,["active"]),t("div",gt,[t("div",ft,[Ct,t("button",{class:"btn btn-primary",type:"button",onClick:e[0]||(e[0]=c=>i.openCouponModal("createNew"))}," 建立新的優惠卷 ")]),t("table",yt,[vt,t("tbody",null,[(l(!0),u($,null,V(n.coupons,(c,S)=>(l(),u("tr",{key:S},[t("td",null,m(c.title),1),t("td",null,m(c.percent)+"%",1),t("td",null,m(i.formatDate(c.due_date)),1),t("td",null,[c.is_enabled===1?(l(),u("span",$t,"啟用")):(l(),u("span",Mt,"未啟用"))]),t("td",null,[t("div",Dt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:M(k=>i.openCouponModal("edit",c),["prevent"])},"編輯",8,wt),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:M(k=>i.delCoupon(c),["prevent"])},"刪除",8,xt)])])]))),128))])]),g(h,{pages:n.pagination,onChangePage:i.getCoupons},null,8,["pages","onChangePage"])]),g(w,{ref:"couponModal","is-new":n.isNew,"temp-coupon":n.tempCoupon,onUpdateCoupon:i.updateCoupon},null,8,["is-new","temp-coupon","onUpdateCoupon"]),g(x,{ref:"delModal",item:n.tempCoupon,onDelItem:i.delCoupon},null,8,["item","onDelItem"])],64)}const Nt=y(bt,[["render",St]]);export{Nt as default};
